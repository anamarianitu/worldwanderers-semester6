stages:          # List of stages for jobs, and their order of execution
  # - build
  # - test
  - sonarqube-check
  # - deploy

# build-job:       # This job runs in the build stage, which runs first.
#   stage: build
#   script:
#     - echo "Compiling the code..."
#     - cd backend
#     - cd worldwanderers 
#     - ./gradlew build 
#   # This job runs in the test stage.
# backend-test-job:   # This job runs in the test stage.
#   stage: test    # It only starts when the job in the build stage completes successfully.
#   script:
#     - cd backend
#     - cd worldwanderers 
#     - ./gradlew test
#     - echo "Successfully passed tests"

sonarqube-job:
  stage: sonarqube-check
  variables:
    SONAR_USER_HOME: "${CI_PROJECT_DIR}/.sonar"  # Defines the location of the analysis task cache
    GIT_DEPTH: "0"  # Tells git to fetch all the branches of the project, required by the analysis task
  cache:
    key: "${CI_JOB_NAME}"
    paths:
      - .sonar/cache
  script: ./gradlew sonar
  allow_failure: true
  rules:
    - if: $CI_COMMIT_BRANCH == 'main'


# deploy-job:
#   stage: deploy 
#   image: docker/compose:1.29.2  
#   script:
#     - cd backend
#     - cd worldwanderers 
#     - echo "Deploying the application..."
#     - docker-compose up -d
#   environment:
#     name: production
#   only:
#     - main
